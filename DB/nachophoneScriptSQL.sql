USE `master`
;
/****** Object:  Database `NACHOPHONE`    Script Date: 07/03/2018 14:20:09 ******/
CREATE DATABASE `NACHOPHONE`
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'NACHOPHONE', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\NACHOPHONE.mdf' , SIZE = 8192KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB )
 LOG ON 
( NAME = N'NACHOPHONE_log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\NACHOPHONE_log.ldf' , SIZE = 8192KB , MAXSIZE = 2048GB , FILEGROWTH = 65536KB )
;
ALTER DATABASE `NACHOPHONE` SET COMPATIBILITY_LEVEL = 140
;
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC `NACHOPHONE`.`sp_fulltext_database` @action = 'enable'
end
;
ALTER DATABASE `NACHOPHONE` SET ANSI_NULL_DEFAULT OFF 
;
ALTER DATABASE `NACHOPHONE` 
ALTER DATABASE `NACHOPHONE` 
ALTER DATABASE `NACHOPHONE` SET ANSI_WARNINGS OFF 
;
ALTER DATABASE `NACHOPHONE` SET ARITHABORT OFF 
;
ALTER DATABASE `NACHOPHONE` SET AUTO_CLOSE OFF 
;
ALTER DATABASE `NACHOPHONE` SET AUTO_SHRINK OFF 
;
ALTER DATABASE `NACHOPHONE` SET AUTO_UPDATE_STATISTICS ON 
;
ALTER DATABASE `NACHOPHONE` SET CURSOR_CLOSE_ON_COMMIT OFF 
;
ALTER DATABASE `NACHOPHONE` SET CURSOR_DEFAULT  GLOBAL 
;
ALTER DATABASE `NACHOPHONE` SET CONCAT_NULL_YIELDS_NULL OFF 
;
ALTER DATABASE `NACHOPHONE` SET NUMERIC_ROUNDABORT OFF 
;
ALTER DATABASE `NACHOPHONE` 
ALTER DATABASE `NACHOPHONE` SET RECURSIVE_TRIGGERS OFF 
;
ALTER DATABASE `NACHOPHONE` SET  ENABLE_BROKER 
;
ALTER DATABASE `NACHOPHONE` SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
;
ALTER DATABASE `NACHOPHONE` SET DATE_CORRELATION_OPTIMIZATION OFF 
;
ALTER DATABASE `NACHOPHONE` SET TRUSTWORTHY OFF 
;
ALTER DATABASE `NACHOPHONE` SET ALLOW_SNAPSHOT_ISOLATION OFF 
;
ALTER DATABASE `NACHOPHONE` SET PARAMETERIZATION SIMPLE 
;
ALTER DATABASE `NACHOPHONE` SET READ_COMMITTED_SNAPSHOT OFF 
;
ALTER DATABASE `NACHOPHONE` SET HONOR_BROKER_PRIORITY OFF 
;
ALTER DATABASE `NACHOPHONE` SET RECOVERY FULL 
;
ALTER DATABASE `NACHOPHONE` SET  MULTI_USER 
;
ALTER DATABASE `NACHOPHONE` SET PAGE_VERIFY CHECKSUM  
;
ALTER DATABASE `NACHOPHONE` SET DB_CHAINING OFF 
;
ALTER DATABASE `NACHOPHONE` SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
;
ALTER DATABASE `NACHOPHONE` SET TARGET_RECOVERY_TIME = 60 SECONDS 
;
ALTER DATABASE `NACHOPHONE` SET DELAYED_DURABILITY = DISABLED 
;
EXEC sys.sp_db_vardecimal_storage_format N'NACHOPHONE', N'ON'
;
ALTER DATABASE `NACHOPHONE` SET QUERY_STORE = OFF
;
USE `NACHOPHONE`
;
ALTER DATABASE SCOPED CONFIGURATION SET IDENTITY_CACHE = ON;
;
ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
;
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET LEGACY_CARDINALITY_ESTIMATION = PRIMARY;
;
ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
;
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET MAXDOP = PRIMARY;
;
ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
;
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET PARAMETER_SNIFFING = PRIMARY;
;
ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
;
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET QUERY_OPTIMIZER_HOTFIXES = PRIMARY;
;
USE `NACHOPHONE`
;
/****** Object:  Table `GASTO`    Script Date: 07/03/2018 14:20:10 ******/


CREATE TABLE `GASTO`(
	`idGasto` int AUTO_INCREMENT NOT NULL,
	`usuario` int NULL,
	`tarifa` int NULL,
	`telefono` varchar(13) NOT NULL,
	`mbConsumidos` int NULL,
	`minConsumidos` int NULL,
PRIMARY KEY 
(
	`idGasto` ASC
)
)
;
/****** Object:  Table `PERFIL`    Script Date: 07/03/2018 14:20:11 ******/


CREATE TABLE `PERFIL`(
	`idRol` int AUTO_INCREMENT NOT NULL,
	`rol` varchar(8) NOT NULL,
	`usuario` int NOT NULL,
PRIMARY KEY 
(
	`idRol` ASC
)
)
;
/****** Object:  Table `TARIFA`    Script Date: 07/03/2018 14:20:11 ******/


CREATE TABLE `TARIFA`(
	`idTarifa` int AUTO_INCREMENT NOT NULL,
	`nomTarifa` varchar(20) NULL,
	`precio` double NULL,
	`mbTarifa` int NOT NULL,
	`minTarifa` int NOT NULL,
PRIMARY KEY 
(
	`idTarifa` ASC
)
)
;
/****** Object:  Table `USUARIO`    Script Date: 07/03/2018 14:20:11 ******/


CREATE TABLE `USUARIO`(
	`idUsuario` int AUTO_INCREMENT NOT NULL,
	`nombre` varchar(50) NOT NULL,
	`apellido` varchar(50) NOT NULL,
	`passw` varchar(20) NOT NULL,
	`dni` varchar(9) NOT NULL,
	`tlfUsuario` varchar(13) NOT NULL,
	`email` varchar(50) NOT NULL,
PRIMARY KEY 
(
	`idUsuario` ASC
)
)
;
SET IDENTITY_INSERT `GASTO` ON 

INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (1, 1, 1, N'111111111', 100, 15)
INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (2, 2, 2, N'222222222', 150, 20)
INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (3, 2, 1, N'222222220', 100, 5)
INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (4, 3, 3, N'333333333', 500, 100)
INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (5, 4, 1, N'444444444', 50, 5)
INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (6, 4, 3, N'444444440', 1500, 800)
INSERT `GASTO` (`idGasto`, `usuario`, `tarifa`, `telefono`, `mbConsumidos`, `minConsumidos`) VALUES (7, 5, 2, N'555555555', 250, 10)
SET IDENTITY_INSERT `GASTO` OFF
SET IDENTITY_INSERT `PERFIL` ON 

INSERT `PERFIL` (`idRol`, `rol`, `usuario`) VALUES (1, N'admin', 1)
INSERT `PERFIL` (`idRol`, `rol`, `usuario`) VALUES (2, N'admin', 2)
INSERT `PERFIL` (`idRol`, `rol`, `usuario`) VALUES (3, N'usuario', 3)
INSERT `PERFIL` (`idRol`, `rol`, `usuario`) VALUES (4, N'usuario', 4)
INSERT `PERFIL` (`idRol`, `rol`, `usuario`) VALUES (5, N'usuario', 5)
SET IDENTITY_INSERT `PERFIL` OFF
SET IDENTITY_INSERT `TARIFA` ON 

INSERT `TARIFA` (`idTarifa`, `nomTarifa`, `precio`, `mbTarifa`, `minTarifa`) VALUES (1, N'Pato', 5.95, 500, 40)
INSERT `TARIFA` (`idTarifa`, `nomTarifa`, `precio`, `mbTarifa`, `minTarifa`) VALUES (2, N'Ganso', 12.84, 1000, 300)
INSERT `TARIFA` (`idTarifa`, `nomTarifa`, `precio`, `mbTarifa`, `minTarifa`) VALUES (3, N'Cisne', 21.49, 6000, 1000)
SET IDENTITY_INSERT `TARIFA` OFF
SET IDENTITY_INSERT `USUARIO` ON 

INSERT `USUARIO` (`idUsuario`, `nombre`, `apellido`, `passw`, `dni`, `tlfUsuario`, `email`) VALUES (1, N'Aa', N'Aaa', N'Aa_1', N'11111111A', N'111111111', N'aa@aa.a')
INSERT `USUARIO` (`idUsuario`, `nombre`, `apellido`, `passw`, `dni`, `tlfUsuario`, `email`) VALUES (2, N'Bb', N'Bbb', N'Bb_2', N'22222222B', N'222222222', N'bb@bb.b')
INSERT `USUARIO` (`idUsuario`, `nombre`, `apellido`, `passw`, `dni`, `tlfUsuario`, `email`) VALUES (3, N'Cc', N'Ccc', N'Cc_3', N'33333333C', N'333333333', N'cc@cc.c')
INSERT `USUARIO` (`idUsuario`, `nombre`, `apellido`, `passw`, `dni`, `tlfUsuario`, `email`) VALUES (4, N'Dd', N'Ddd', N'Dd_4', N'44444444D', N'444444444', N'dd@dd.d')
INSERT `USUARIO` (`idUsuario`, `nombre`, `apellido`, `passw`, `dni`, `tlfUsuario`, `email`) VALUES (5, N'Ee', N'Eee', N'Ee_5', N'55555555E', N'555555555', N'ee@ee.e')
SET IDENTITY_INSERT `USUARIO` OFF

/****** Object:  Index `UQ__GASTO__2A16D945EF636C48`    Script Date: 07/03/2018 14:20:12 ******/
ALTER TABLE `GASTO` ADD UNIQUE NONCLUSTERED 
(
	`telefono` ASC
)
;

/****** Object:  Index `UQ__TARIFA__544226C7E0D62ED3`    Script Date: 07/03/2018 14:20:12 ******/
ALTER TABLE `TARIFA` ADD UNIQUE NONCLUSTERED 
(
	`nomTarifa` ASC
)
;

/****** Object:  Index `UQ__USUARIO__D87608A7A27C8907`    Script Date: 07/03/2018 14:20:12 ******/
ALTER TABLE `USUARIO` ADD UNIQUE NONCLUSTERED 
(
	`dni` ASC
)
;
ALTER TABLE `GASTO`  WITH CHECK ADD FOREIGN KEY(`tarifa`)
REFERENCES `TARIFA` (`idTarifa`)
;
ALTER TABLE `GASTO`  WITH CHECK ADD FOREIGN KEY(`usuario`)
REFERENCES `USUARIO` (`idUsuario`)
;
ALTER TABLE `PERFIL`  WITH CHECK ADD FOREIGN KEY(`usuario`)
REFERENCES `USUARIO` (`idUsuario`)
;
ALTER TABLE `PERFIL`  WITH CHECK ADD CHECK  ((`ROL`='usuario' OR `ROL`='admin'))
;
ALTER TABLE `USUARIO`  WITH CHECK ADD CHECK  ((`dni` like '`0-9``0-9``0-9``0-9``0-9``0-9``0-9``0-9``A-Z`'))
;
USE `master`
;
ALTER DATABASE `NACHOPHONE` SET  READ_WRITE 
;
